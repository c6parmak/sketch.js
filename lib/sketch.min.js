(function(){var a=[].slice;!function(b){var c;return b.fn.sketch=function(){var d,e,f;return e=arguments[0],d=2<=arguments.length?a.call(arguments,1):[],this.length>1&&b.error("Sketch.js can only be called on one element at a time."),f=this.data("sketch"),"string"==typeof e&&f?f[e]?"function"==typeof f[e]?f[e].apply(f,d):0===d.length?f[e]:1===d.length?f[e]=d[0]:void 0:b.error("Sketch.js did not recognize the given command."):f?f:(this.data("sketch",new c(this.get(0),e)),this)},c=function(){function a(a,c){this.el=a,this.canvas=b(a),this.context=a.getContext("2d"),this.options=b.extend({toolLinks:!0,defaultTool:"marker",defaultColor:"#000000",defaultSize:5},c),this.painting=!1,this.color=this.options.defaultColor,this.size=this.options.defaultSize,this.tool=this.options.defaultTool,this.actions=[],this.action=[],this.canvas.bind("click mousedown mouseup mousemove mouseleave mouseout touchstart touchmove touchend touchcancel",this.onEvent),this.options.toolLinks&&b("body").delegate('a[href="#'+this.canvas.attr("id")+'"]',"click",function(a){var c,d,e,f,g,h,i;for(d=b(this),c=b(d.attr("href")),i=c.data("sketch"),h=["color","size","tool"],e=0,g=h.length;g>e;e++)f=h[e],d.attr("data-"+f)&&i.set(f,b(this).attr("data-"+f));return b(this).attr("data-download")&&i.download(b(this).attr("data-download")),!1})}return a.prototype.download=function(a){var b;return a||(a="png"),"jpg"===a&&(a="jpeg"),b="image/"+a,window.open(this.el.toDataURL(b))},a.prototype.set=function(a,b){return this[a]=b,this.canvas.trigger("sketch.change"+a,b)},a.prototype.startPainting=function(){return this.painting=!0,this.action={tool:this.tool,color:this.color,size:parseFloat(this.size),events:[]}},a.prototype.stopPainting=function(){return this.action&&this.actions.push(this.action),this.painting=!1,this.action=null,this.redraw()},a.prototype.onEvent=function(a){return a.originalEvent&&a.originalEvent.targetTouches&&a.originalEvent.targetTouches.length&&(a.pageX=a.originalEvent.targetTouches[0].pageX,a.pageY=a.originalEvent.targetTouches[0].pageY),b.sketch.tools[b(this).data("sketch").tool].onEvent.call(b(this).data("sketch"),a),a.preventDefault(),!1},a.prototype.redraw=function(){var a;return this.context=this.el.getContext("2d"),a=this,this.painting&&this.action?b.sketch.tools[this.action.tool].draw.call(a,this.action):void 0},a}(),b.sketch={tools:{}},b.sketch.tools.marker={onEvent:function(a){switch(a.type){case"mousedown":case"touchstart":this.startPainting();break;case"mouseup":case"mouseout":case"mouseleave":case"touchend":case"touchcancel":this.stopPainting()}return this.painting?(this.action.events.push({x:a.pageX-this.canvas.offset().left,y:a.pageY-this.canvas.offset().top,event:a.type}),this.redraw()):void 0},draw:function(a){var b,c,d,e,f;for(this.context.lineJoin="round",this.context.lineCap="round",this.context.beginPath(),this.context.moveTo(a.events[0].x,a.events[0].y),f=a.events,c=0,d=f.length;d>c;c++)b=f[c],this.context.lineTo(b.x,b.y),e=b;return this.context.strokeStyle=a.color,this.context.lineWidth=a.size,this.context.stroke()}},b.sketch.tools.eraser={onEvent:function(a){return b.sketch.tools.marker.onEvent.call(this,a)},draw:function(a){var c;return c=this.context.globalCompositeOperation,this.context.globalCompositeOperation="destination-out",a.color="rgba(0,0,0,1)",b.sketch.tools.marker.draw.call(this,a),this.context.globalCompositeOperation=c}}}(jQuery)}).call(this);